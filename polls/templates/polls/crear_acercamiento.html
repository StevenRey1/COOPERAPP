{% extends 'base.html' %}

{% block content %}
  <h2>ACERCAMIENTOS DE COOPERACIÓN INTERNACIONAL - Reporte {{ reporte }}</h2>
  <p>¿Ha realizado algún tipo de acercamiento con alguna entidad de cooperación internacional en este periodo X?</p>

  <!-- Radio buttons para 'Sí' y 'No' -->
  <div>
    <input type="radio" id="si" name="acercamiento" value="si" onclick="toggleForm(true)">
    <label for="si">Sí</label>

    <input type="radio" id="no" name="acercamiento" value="no" onclick="toggleForm(false)" checked>
    <label for="no">No</label>
  </div>

  <!-- El formulario, inicialmente oculto si se selecciona 'No' -->
  <form method="POST" id="acercamientoForm" style="display: none;">
    {% csrf_token %}
    <fieldset id="acercamientoFormContainer">
      <!-- Formulario inicial -->
      <div class="acercamiento-form">
        <div class="form-group">
          <label for="id_entidad_1">Mencione aquí el nombre de la entidad con quien ha realizado los acercamientos</label>
          <input type="text" name="entidad" id="id_entidad_1" class="form-control" placeholder="Texto máximo 20 palabras" required>
        </div>
        <div class="form-group">
          <label for="id_temas_perspectivas_1">Mencione aquí los temas y perspectivas de trabajo colaborativo:</label>
          <textarea name="temas_perspectivas" id="id_temas_perspectivas_1" class="form-control" placeholder="Texto máximo 100 palabras" required></textarea>
        </div>
      </div>
    </fieldset>

    <fieldset id="fieldAddForm" style="display: none;">
      <div class="col-10">
        <button type="button" class="btn btn-success" onclick="addForm()">Agregar otro</button>
      </div>
      <div class="col-10">
        <button type="submit" class="btn btn-success">Guardar</button>
      </div>
    </fieldset>
  </form>
  <fieldset id="continuar_sin_guardar" style="display: block;">
    <a href="{% url 'polls:saltar_acercamiento' reporte.id %}" class="btn btn-primary">Continuar</a>
</fieldset>

{% endblock %}

{% block extra_js %}
<!-- JavaScript para mostrar/ocultar el formulario y clonar nuevos formularios -->
<script type="text/javascript">
  let formCount = 1;  // Contador para formularios

  function toggleForm(show) {
    const formFieldset = document.getElementById('acercamientoForm');
    const continueField = document.getElementById('continuar_sin_guardar');
    const addField = document.getElementById('fieldAddForm');
    
    if (show) {
      formFieldset.style.display = 'block';  // Muestra el formulario si se selecciona 'Sí'
      addField.style.display = 'block';
      continueField.style.display = 'none';
    } else {
      formFieldset.style.display = 'none';  // Oculta el formulario si se selecciona 'No'
      addField.style.display = 'none';
      continueField.style.display = 'block';
    }
  }

  function addForm() {
    formCount++;
    const formContainer = document.getElementById('acercamientoFormContainer');

    // Clonar el formulario existente
    const newForm = document.querySelector('.acercamiento-form').cloneNode(true);
    
    // Actualizar IDs y nombres de campos para el nuevo formulario
    const newFormHTML = newForm.innerHTML
      .replace(/id_entidad_1/g, `id_entidad_${formCount}`)
      .replace(/id_temas_perspectivas_1/g, `id_temas_perspectivas_${formCount}`);
    
    newForm.innerHTML = newFormHTML;

    // Agregar el botón de eliminar al nuevo formulario
    const deleteButton = document.createElement('button');
    deleteButton.type = 'button';
    deleteButton.className = 'btn btn-danger';
    deleteButton.textContent = 'Eliminar';
    deleteButton.onclick = () => removeForm(newForm);

    newForm.appendChild(deleteButton);
    
    // Añadir el nuevo formulario al contenedor
    formContainer.appendChild(newForm);
  }

  function removeForm(form) {
    const formContainer = document.getElementById('acercamientoFormContainer');
    if (formContainer.children.length > 1) { // Asegura que siempre quede al menos un formulario
      form.remove();
    }
  }

  // Inicializar el estado del formulario
  document.getElementById('no').checked ? toggleForm(false) : toggleForm(true);
</script>
{% endblock %}