{% extends 'base.html' %}

{% block content %}
  <h2>Editar Necesidades para {{ object.reporte }}</h2>

  <form method="post">
    {% csrf_token %}

    <!-- Checkbox para necesidad identificada -->
    <div class="form-check">
      <input type="checkbox" id="necesidad_identificado" name="necesidad_identificado" 
             {% if form.necesidad_identificado.value %} checked {% endif %}
             onclick="toggleFields()">
      <label for="necesidad_identificado">Necesidad Identificada</label>
    </div>

    <!-- Campo de texto para necesidades identificadas -->
    <div class="form-group">
      <label for="{{ form.necesidades_identificadas.id_for_label }}">Necesidades Identificadas:</label>
      {{ form.necesidades_identificadas }}
    </div>

    <!-- Checkbox para cooperante identificado -->
    <div class="form-check">
      <input type="checkbox" id="cooperante_identificado" name="cooperante_identificado" 
             {% if form.cooperante_identificado.value %} checked {% endif %}
             onclick="toggleFields()">
      <label for="cooperante_identificado">Cooperante Identificado</label>
    </div>

    <!-- Campo de texto para cooperante -->
    <div class="form-group">
      <label for="{{ form.cooperante.id_for_label }}">Cooperante:</label>
      {{ form.cooperante }}
    </div>

    <button type="submit" class="btn btn-primary">Guardar cambios</button>
    <a href="{% url 'polls:ver_necesidades' reporte_id=object.reporte.id %}" class="btn btn-secondary">Cancelar</a>
  </form>

{% endblock %}

{% block extra_js %}
<script type="text/javascript">
  function toggleFields() {
    // Obtener el estado de los checkboxes
    var necesidadIdentificado = document.getElementById('necesidad_identificado').checked;
    var cooperanteIdentificado = document.getElementById('cooperante_identificado').checked;

    // Obtener los campos de texto
    var necesidadesIdentificadasField = document.getElementById('id_necesidades_identificadas');
    var cooperanteField = document.getElementById('id_cooperante');

    // Deshabilitar o habilitar los campos según el estado de los checkboxes
    necesidadesIdentificadasField.disabled = !necesidadIdentificado;
    cooperanteField.disabled = !cooperanteIdentificado;

    // Limpiar los campos si se desmarcan los checkboxes
    if (!necesidadIdentificado) {
      necesidadesIdentificadasField.value = '';  // Limpiar el campo de necesidades identificadas
    }
    if (!cooperanteIdentificado) {
      cooperanteField.value = '';  // Limpiar el campo de cooperante
    }

    // Hacer que los campos sean requeridos o no
    necesidadesIdentificadasField.required = necesidadIdentificado;
    cooperanteField.required = cooperanteIdentificado;
  }

  // Inicializar el estado de los campos en base a los valores del formulario al cargar la página
  document.addEventListener('DOMContentLoaded', function() {
    toggleFields();  // Ejecutar la función cuando la página haya cargado
  });
</script>
{% endblock %}
